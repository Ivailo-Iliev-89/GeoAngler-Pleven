{% extends 'base.html' %}
{% load static %}

{% block content %}
<div class="detail-container">

    <div class="detail-header">
        <h1>{{ place.name }}</h1>
        <p class="location-tag">
            üìç Region: {{ place.region }} / Type: {{ place.get_place_type_display }}
        </p>
    </div>

    <hr class="map-divider"/>

    <div class="place-description-text">
        <h3>Additional information</h3>
        <p>{{ place.description|linebreaks }}</p>
    </div>

    <div class="detail-content">
        <div class="main-image">
            {% if place.image %}
                <img src="{{ place.image.url }}" alt="{{ place.name }}">
            {% endif %}
        </div>

        <div class="info-sidebar">
            <div class="info-box">
                <h4>‚öì Appropriate methods:</h4>
                <ul class="nav-links" style="flex-direction: column; gap: 5px;">
                    {% for method in place.methods.all %}
                        <li><a href="{% url 'method_detail' method.slug %}" style="color: #1a3c34;">{{ method.name }}</a></li>
                    {% endfor %}
                </ul>
            </div>

            <div class="info-box">
                <h4>üêü Types of fish here:</h4>
                <div class="fish-list">
                    {% for fish in place.fishes.all %}
                        <span class="fish-item">{{ fish.name }}</span>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>

    {% if place.map_embed %}
    <hr class="map-divider"/>
    <div class="map-container">
        <h3 class="map-title">üìç Location (Google Map):</h3>
        <div class="responsive-map">
            {{ place.map_embed|safe }}
        </div>
    </div>
    {% endif %}
    
</div>

<hr class="map-divider"/>

<div class="user-reports-container">
    <h3 class="section-title">üì∏ Fishing Reports & Photos for {{ place.name }}</h3>
    
    <div class="reports-grid">
        {% for post in place.posts.all %} 
            <div class="report-card">
                {% if post.image %}
                    <img src="{{ post.image.url }}" alt="{{ post.title }}">
                {% endif %}
                <div class="report-card-body">
                    <h4>{{ post.title }}</h4>
                    <p class="report-meta">
                        By: <strong>{{ post.author.username }}</strong> | {{ post.created_on|date:"d M Y" }}
                    </p>
                    <p class="report-text">{{ post.content|truncatewords:15 }}</p>
                    <a href="{% url 'post_detail' post.slug %}" class="btn-more" style="margin-top: 10px;">View full report ‚Üí</a>
                </div>
            </div>
        {% empty %}
            <p style="text-align: center; grid-column: 1 / -1; color: #888; font-style: italic;">
                No reports yet for this location. Be the first to share your catch!
            </p>
        {% endfor %}
    </div>
</div>
{% endblock %}